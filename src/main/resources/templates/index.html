<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Système de Gestion de Documents</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <div class="d-flex">
        <div class="bg-dark text-white p-4" style="width: 250px;">
            <h2 class="text-center mb-4">Système de Gestion de Documents</h2>
            <div th:if="${isLoggedIn}">
                <form th:action="@{/add-document}" method="get">
                    <button type="submit" class="btn btn-outline-light w-100 mb-3">Ajouter un Document</button>
                </form>
                <div th:each="document : ${documents}">
                    <form th:action="@{/edit-document/{id}(id=${document.id})}" method="get" style="display:inline;">
                        <button type="submit" class="btn btn-outline-light w-100 mb-3">Modifier Document</button>
                    </form>
                    <form th:action="@{/delete-document/{id}(id=${document.id})}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-outline-danger w-100 mb-3" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce document ?');">Supprimer Document</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-grow-1 p-4">
            <!-- Afficher le message de succès -->
            <div th:if="${message}" class="alert alert-success">
                <span th:text="${message}"></span>
            </div>

            <!-- Formulaire de recherche -->
            <div class="mb-4">
                <input type="text" placeholder="Rechercher des documents..." th:name="searchQuery" class="form-control mb-3" />
                <!-- Bouton de filtre avancé -->
                <form th:action="@{/toggle-filter}" method="post" style="display:inline;">
                    <input type="hidden" name="showFilter" th:value="${showFilter}" />
                    <button type="submit" class="btn btn-primary">Filtre Avancé</button>
                </form>
            </div>

            <!-- Formulaire de filtrage avancé (si activé) -->
            <div th:if="${showFilter}" class="mb-4">
                <h3>Filtrer par :</h3>
                <form th:action="@{/apply-filters}" method="post">
                    <div class="mb-3">
                        <label for="documentType" class="form-label">Type de document</label>
                        <select id="documentType" name="documentType" class="form-select">
                            <option value="">Sélectionnez un type</option>
                            <option value="thesis">Thèse</option>
                            <option value="article">Article</option>
                            <option value="report">Rapport</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="documentGenre" class="form-label">Genre du document</label>
                        <select id="documentGenre" name="documentGenre" class="form-select">
                            <option value="">Sélectionnez un genre</option>
                            <option value="research">Recherche</option>
                            <option value="presentation">Présentation</option>
                            <option value="publication">Publication</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="author" class="form-label">Auteur</label>
                        <input type="text" id="author" name="author" class="form-control" placeholder="Nom de l'auteur" />
                    </div>
                    <button type="submit" class="btn btn-primary">Appliquer le filtre</button>
                </form>
            </div>

            <!-- Liste des documents -->
            <div th:each="document : ${documents}" class="mb-3">
                <div class="card">
                    <div class="card-body">
                        <input type="radio" class="form-check-input" id="doc-${document.id}" name="selectedDocument" th:value="${document.id}" required>
                        <label class="form-check-label" for="doc-${document.id}">
                            <h5 class="card-title" th:text="${document.title}"></h5>
                            <h6 class="card-subtitle mb-2 text-muted" th:text="${document.author}"></h6>
                            <p class="card-text" th:text="${#strings.abbreviate(document.summary, 200)}"></p>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Bouton pour consulter le document sélectionné -->
            <button type="submit" class="btn btn-success mt-3">Consulter le document sélectionné</button>
        </div>

        <!-- Section "Bienvenue" -->
        <div class="bg-light text-center p-4" style="width: 250px;">
            <h3>Bienvenue, <span th:text="${userName}">Utilisateur</span></h3>
        </div>
    </div>

    <!-- Bouton de déconnexion -->
    <div th:if="${isLoggedIn}" class="container mt-3">
        <form th:action="@{/logout}" method="post">
            <button type="submit" class="btn btn-danger w-100">Se déconnecter</button>
        </form>
    </div>

    <!-- Script JS de Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
